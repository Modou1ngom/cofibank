import{_ as h,c as n,a as s,b as w,F as c,r as v,t as d,w as g,d as m,v as p,e as b,f as u,o as a}from"./app-CQzh8JQY.js";const y={name:"UserManagementPage",data(){return{users:[],profiles:[],showCreateModal:!1,editingUser:null,form:{name:"",email:"",password:"",profile_id:""}}},async mounted(){await Promise.all([this.loadUsers(),this.loadProfiles()])},methods:{async loadUsers(){try{const l=await u.get("/api/admin/users");this.users=l.data}catch(l){console.error("Erreur:",l),alert("Erreur lors du chargement des utilisateurs")}},async loadProfiles(){try{const l=await u.get("/api/profiles");this.profiles=l.data.filter(e=>e.is_active)}catch(l){console.error("Erreur:",l)}},editUser(l){this.editingUser=l,this.form={name:l.name,email:l.email,password:"",profile_id:l.profile_id}},async saveUser(){var l,e;try{const o={...this.form};this.editingUser&&!o.password&&delete o.password,this.editingUser?await u.put(`/api/admin/users/${this.editingUser.id}`,o):await u.post("/api/admin/users",o),await this.loadUsers(),this.closeModal()}catch(o){alert(((e=(l=o.response)==null?void 0:l.data)==null?void 0:e.message)||"Erreur lors de la sauvegarde")}},async deleteUser(l){var e,o;if(confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur "${l.name}" ?`))try{await u.delete(`/api/admin/users/${l.id}`),await this.loadUsers()}catch(f){alert(((o=(e=f.response)==null?void 0:e.data)==null?void 0:o.message)||"Erreur lors de la suppression")}},closeModal(){this.showCreateModal=!1,this.editingUser=null,this.form={name:"",email:"",password:"",profile_id:""}}}},M={class:"user-management"},k={class:"page-header"},C={class:"users-table"},_={key:0,class:"profile-badge"},E={key:1,class:"no-profile"},P=["onClick"],V=["onClick"],q={class:"form-group"},x={class:"form-group"},N={class:"form-group"},S=["required"],A={class:"form-group"},B=["value"],D={class:"modal-actions"};function F(l,e,o,f,t,i){return a(),n("div",M,[s("div",k,[e[9]||(e[9]=s("h1",null,"Gestion des Utilisateurs",-1)),s("button",{onClick:e[0]||(e[0]=r=>t.showCreateModal=!0),class:"btn-primary"}," + Créer un utilisateur ")]),s("div",C,[s("table",null,[e[10]||(e[10]=s("thead",null,[s("tr",null,[s("th",null,"Nom"),s("th",null,"Email"),s("th",null,"Profil"),s("th",null,"Actions")])],-1)),s("tbody",null,[(a(!0),n(c,null,v(t.users,r=>(a(),n("tr",{key:r.id},[s("td",null,d(r.name),1),s("td",null,d(r.email),1),s("td",null,[r.profile?(a(),n("span",_,d(r.profile.name),1)):(a(),n("span",E,"Aucun profil"))]),s("td",null,[s("button",{onClick:U=>i.editUser(r),class:"btn-edit"},"Modifier",8,P),s("button",{onClick:U=>i.deleteUser(r),class:"btn-delete"},"Supprimer",8,V)])]))),128))])])]),t.showCreateModal||t.editingUser?(a(),n("div",{key:0,class:"modal-overlay",onClick:e[8]||(e[8]=(...r)=>i.closeModal&&i.closeModal(...r))},[s("div",{class:"modal-content",onClick:e[7]||(e[7]=g(()=>{},["stop"]))},[s("h2",null,d(t.editingUser?"Modifier l'utilisateur":"Créer un utilisateur"),1),s("form",{onSubmit:e[6]||(e[6]=g((...r)=>i.saveUser&&i.saveUser(...r),["prevent"]))},[s("div",q,[e[11]||(e[11]=s("label",null,"Nom *",-1)),m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.form.name=r),required:"",placeholder:"Nom complet"},null,512),[[p,t.form.name]])]),s("div",x,[e[12]||(e[12]=s("label",null,"Email *",-1)),m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.form.email=r),type:"email",required:"",placeholder:"email@cofina.sn"},null,512),[[p,t.form.email]])]),s("div",N,[s("label",null,"Mot de passe "+d(t.editingUser?"(laisser vide pour ne pas changer)":"*"),1),m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>t.form.password=r),type:"password",required:!t.editingUser,placeholder:"••••••••"},null,8,S),[[p,t.form.password]])]),s("div",A,[e[14]||(e[14]=s("label",null,"Profil *",-1)),m(s("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.form.profile_id=r),required:""},[e[13]||(e[13]=s("option",{value:""},"Sélectionnez un profil",-1)),(a(!0),n(c,null,v(t.profiles,r=>(a(),n("option",{key:r.id,value:r.id},d(r.name)+" - "+d(r.description),9,B))),128))],512),[[b,t.form.profile_id]])]),s("div",D,[s("button",{type:"button",onClick:e[5]||(e[5]=(...r)=>i.closeModal&&i.closeModal(...r)),class:"btn-cancel"},"Annuler"),e[15]||(e[15]=s("button",{type:"submit",class:"btn-save"},"Enregistrer",-1))])],32)])])):w("",!0)])}const G=h(y,[["render",F],["__scopeId","data-v-75e8ed59"]]);export{G as default};
