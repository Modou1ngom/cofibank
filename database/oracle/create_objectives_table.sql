-- Script SQL pour créer la table OBJECTIFS dans Oracle
-- Cette table stocke les objectifs personnalisés pour les agences

CREATE TABLE OBJECTIFS (
    ID_OBJECTIF NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TYPE_OBJECTIF VARCHAR2(20) NOT NULL CHECK (TYPE_OBJECTIF IN ('CLIENT', 'PRODUCTION')),
    CATEGORIE VARCHAR2(50) NOT NULL CHECK (CATEGORIE IN ('TERRITOIRE', 'POINT SERVICES', 'GRAND COMPTE')),
    TERRITOIRE VARCHAR2(50),
    CODE_AGENCE VARCHAR2(100) NOT NULL,
    NOM_AGENCE VARCHAR2(200),
    VALEUR NUMBER(15, 2) NOT NULL,
    PERIODE VARCHAR2(20) NOT NULL CHECK (PERIODE IN ('month', 'quarter', 'year')),
    ANNEE NUMBER(4) NOT NULL,
    MOIS NUMBER(2),
    TRIMESTRE NUMBER(1),
    DESCRIPTION VARCHAR2(500),
    DATE_CREATION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DATE_MODIFICATION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT CHK_MOIS CHECK (MOIS IS NULL OR (MOIS >= 1 AND MOIS <= 12)),
    CONSTRAINT CHK_TRIMESTRE CHECK (TRIMESTRE IS NULL OR (TRIMESTRE >= 1 AND TRIMESTRE <= 4)),
    CONSTRAINT CHK_PERIODE_MOIS CHECK (
        (PERIODE = 'month' AND MOIS IS NOT NULL) OR
        (PERIODE = 'quarter' AND TRIMESTRE IS NOT NULL) OR
        (PERIODE = 'year')
    )
);

-- Index pour améliorer les performances de recherche
CREATE INDEX IDX_OBJECTIFS_TYPE_ANNEE ON OBJECTIFS(TYPE_OBJECTIF, ANNEE);
CREATE INDEX IDX_OBJECTIFS_CODE_AGENCE ON OBJECTIFS(CODE_AGENCE);
CREATE INDEX IDX_OBJECTIFS_CATEGORIE ON OBJECTIFS(CATEGORIE);
CREATE INDEX IDX_OBJECTIFS_PERIODE ON OBJECTIFS(PERIODE, ANNEE, MOIS, TRIMESTRE);

-- Commentaires sur la table et les colonnes
COMMENT ON TABLE OBJECTIFS IS 'Table des objectifs personnalisés pour les agences';
COMMENT ON COLUMN OBJECTIFS.ID_OBJECTIF IS 'Identifiant unique de l''objectif';
COMMENT ON COLUMN OBJECTIFS.TYPE_OBJECTIF IS 'Type d''objectif: CLIENT ou PRODUCTION';
COMMENT ON COLUMN OBJECTIFS.CATEGORIE IS 'Catégorie: TERRITOIRE, POINT SERVICES, ou GRAND COMPTE';
COMMENT ON COLUMN OBJECTIFS.CODE_AGENCE IS 'Code de l''agence';
COMMENT ON COLUMN OBJECTIFS.NOM_AGENCE IS 'Nom de l''agence';
COMMENT ON COLUMN OBJECTIFS.VALEUR IS 'Valeur de l''objectif';
COMMENT ON COLUMN OBJECTIFS.PERIODE IS 'Période: month, quarter, ou year';
COMMENT ON COLUMN OBJECTIFS.ANNEE IS 'Année de l''objectif';
COMMENT ON COLUMN OBJECTIFS.MOIS IS 'Mois (si période = month)';
COMMENT ON COLUMN OBJECTIFS.TRIMESTRE IS 'Trimestre (si période = quarter)';
